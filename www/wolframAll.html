<style type="text/css">
div {
    width: 276px;
    float: left;
}

p {
    margin-left: 10px;
}

canvas, img {
    margin: 10px;
}

span {
    width: 100%;
    margin-left: 10px;
}
</style>
<script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="js/ca.js"></script>
<script type="text/javascript">

window.onload = function() {
    
    var automata;
    var num = 0;
    
    function animate() {
        
        if (automata && !automata.completed()) {
            
            for (var i = 0; i < 256; i++) {
                automata.proceed();
            }
            
        } else {
            next();
        }
        
        setTimeout(animate, 1000 / 30);
    }
    
    function factoryAutomata(i) {
        
        var automata = new ca.Automata(new ca.Rule2x3(i), 256, 256);

        /* initialize
         =============*/
        automata.set(automata.width / 2, 0, 1);
        automata.completed = function() {
            return this.steps > this.height;
        }
        
        var dom = $('<div>');
        var label = $('<span>').text('Rule' + num);
        dom.append($(automata.canvas));
        dom.append(label);
        $('body').append(dom);
        
        return automata;
    }
    
    function switchCanvasToImg() {
        
        var data = automata.canvas.toDataURL("image/jpeg")
        
        var image = new Image();
        image.src = data;
        image.width = automata.width;
        image.height = automata.height;
        
        $(automata.canvas).replaceWith(image);
        
        $.get("cgi-bin/save.py", "name="+(num-1)+"&data="+data, function(e) {
            
        });
    }
    
    function next() {
        
        if (num <= 256) {
            
            // switch from canvas to img for performance
            if (automata) switchCanvasToImg();
            
            automata = factoryAutomata(num);
        }
        
        num++;
    }
    
    
    next();
    
    setTimeout(animate, 0);
    
}

</script>

<p>This is 256 cellular automata test</p>